{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});}keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}var FirebaseAnalyticsJS=function(){function FirebaseAnalyticsJS(config,options){_classCallCheck(this,FirebaseAnalyticsJS);this.eventQueue=new Set();this.flushEventsPromise=Promise.resolve();this.lastTime=-1;this.sequenceNr=1;if(!config.measurementId)throw new Error('No valid measurementId. Make sure to provide a valid measurementId with a G-XXXXXXXXXX format.');if(!options.clientId)throw new Error('No valid clientId. Make sure to provide a valid clientId with a UUID (v4) format.');this.url='https://www.google-analytics.com/g/collect';this.enabled=true;this.config=config;this.options=_objectSpread({customArgs:{},maxCacheTime:5000,strictNativeEmulation:false,origin:'firebase'},options);}_createClass(FirebaseAnalyticsJS,[{key:\"send\",value:function send(events){var _this=this;var config,options,queryArgs,body,lastTime,event,args,url;return _regeneratorRuntime.async(function send$(_context){while(1){switch(_context.prev=_context.next){case 0:config=this.config,options=this.options;queryArgs=_objectSpread(_objectSpread({},options.customArgs),{},{v:2,tid:config.measurementId,cid:options.clientId,sid:options.sessionId,_s:this.sequenceNr++,seg:1});if(options.sessionNumber)queryArgs.sct=options.sessionNumber;if(options.userLanguage)queryArgs.ul=options.userLanguage;if(options.appName)queryArgs.an=options.appName;if(options.appVersion)queryArgs.av=options.appVersion;if(options.docTitle)queryArgs.dt=options.docTitle;if(options.docLocation)queryArgs.dl=options.docLocation;if(options.screenRes)queryArgs.sr=options.screenRes;if(options.debug)queryArgs._dbg=1;if(this.sequenceNr===2)queryArgs._ss=1;lastTime=this.lastTime;if(events.size>1){body='';events.forEach(function(event){body+=encodeQueryArgs(event,_this.lastTime)+'\\n';_this.lastTime=event._et;});}else if(events.size===1){event=events.values().next().value;this.lastTime=event._et;queryArgs=_objectSpread(_objectSpread({},event),queryArgs);}args=encodeQueryArgs(queryArgs,lastTime);url=this.url+\"?\"+args;_context.next=17;return _regeneratorRuntime.awrap(fetch(url,{method:'POST',mode:'no-cors',cache:'no-cache',headers:_objectSpread({'Content-Type':'text/plain;charset=UTF-8'},options.headers||{}),body:body}));case 17:case\"end\":return _context.stop();}}},null,this,null,Promise);}},{key:\"addEvent\",value:function addEvent(event){var _this2=this;var userId,userProperties,options,name;return _regeneratorRuntime.async(function addEvent$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:userId=this.userId,userProperties=this.userProperties,options=this.options;if(userId)event.uid=userId;if(userProperties){for(name in userProperties){event[name]=userProperties[name];}this.userProperties=undefined;}this.eventQueue.add(event);if(!this.flushEventsTimer){this.flushEventsTimer=setTimeout(function _callee(){return _regeneratorRuntime.async(function _callee$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this2.flushEventsTimer=undefined;_context2.prev=1;_context2.next=4;return _regeneratorRuntime.awrap(_this2.flushEventsPromise);case 4:_context2.next=8;break;case 6:_context2.prev=6;_context2.t0=_context2[\"catch\"](1);case 8:_this2.flushEventsPromise=_this2.flushEvents();case 9:case\"end\":return _context2.stop();}}},null,null,[[1,6]],Promise);},options.debug?10:options.maxCacheTime);}case 5:case\"end\":return _context3.stop();}}},null,this,null,Promise);}},{key:\"flushEvents\",value:function flushEvents(){var _this3=this;var events;return _regeneratorRuntime.async(function flushEvents$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(this.eventQueue.size){_context4.next=2;break;}return _context4.abrupt(\"return\");case 2:events=new Set(this.eventQueue);_context4.next=5;return _regeneratorRuntime.awrap(this.send(events));case 5:events.forEach(function(event){return _this3.eventQueue.delete(event);});case 6:case\"end\":return _context4.stop();}}},null,this,null,Promise);}},{key:\"clearEvents\",value:function clearEvents(){this.eventQueue.clear();if(this.flushEventsTimer){clearTimeout(this.flushEventsTimer);this.flushEventsTimer=0;}}},{key:\"logEvent\",value:function logEvent(eventName,eventParams){var event;return _regeneratorRuntime.async(function logEvent$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:event=FirebaseAnalyticsJS.parseEvent(this.options,eventName,eventParams);if(this.enabled){_context5.next=3;break;}return _context5.abrupt(\"return\");case 3:if(this.options.debug){console.log(\"FirebaseAnalytics event: \\\"\"+eventName+\"\\\", params: \"+JSON.stringify(eventParams,undefined,2));}return _context5.abrupt(\"return\",this.addEvent(event));case 5:case\"end\":return _context5.stop();}}},null,this,null,Promise);}},{key:\"setAnalyticsCollectionEnabled\",value:function setAnalyticsCollectionEnabled(isEnabled){return _regeneratorRuntime.async(function setAnalyticsCollectionEnabled$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:this.enabled=isEnabled;case 1:case\"end\":return _context6.stop();}}},null,this,null,Promise);}},{key:\"setSessionTimeoutDuration\",value:function setSessionTimeoutDuration(_sessionTimeoutInterval){return _regeneratorRuntime.async(function setSessionTimeoutDuration$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:case\"end\":return _context7.stop();}}},null,null,null,Promise);}},{key:\"setUserId\",value:function setUserId(userId){return _regeneratorRuntime.async(function setUserId$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:if(this.enabled){_context8.next=2;break;}return _context8.abrupt(\"return\");case 2:this.userId=userId||undefined;case 3:case\"end\":return _context8.stop();}}},null,this,null,Promise);}},{key:\"setUserProperties\",value:function setUserProperties(userProperties){var name,val,key;return _regeneratorRuntime.async(function setUserProperties$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:if(this.enabled){_context9.next=2;break;}return _context9.abrupt(\"return\");case 2:for(name in userProperties){val=userProperties[name];key=FirebaseAnalyticsJS.parseUserProperty(this.options,name,val);if(val===null||val===undefined){if(this.userProperties){delete this.userProperties[key];}}else{this.userProperties=this.userProperties||{};this.userProperties[key]=val;}}case 3:case\"end\":return _context9.stop();}}},null,this,null,Promise);}},{key:\"resetAnalyticsData\",value:function resetAnalyticsData(){return _regeneratorRuntime.async(function resetAnalyticsData$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:this.clearEvents();this.userId=undefined;this.userProperties=undefined;case 3:case\"end\":return _context10.stop();}}},null,this,null,Promise);}},{key:\"setDebugModeEnabled\",value:function setDebugModeEnabled(isEnabled){return _regeneratorRuntime.async(function setDebugModeEnabled$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:this.options.debug=isEnabled;case 1:case\"end\":return _context11.stop();}}},null,this,null,Promise);}},{key:\"setClientId\",value:function setClientId(clientId){this.options.clientId=clientId;}}],[{key:\"isValidName\",value:function isValidName(name,maxLength){return!!(name&&name.length&&name.length<=maxLength&&name.match(/^[A-Za-z][A-Za-z_\\d]*$/)&&!name.startsWith('firebase_')&&!name.startsWith('google_')&&!name.startsWith('ga_'));}},{key:\"parseEvent\",value:function parseEvent(options,eventName,eventParams){if(!FirebaseAnalyticsJS.isValidName(eventName,40)){throw new Error(\"Invalid event-name (\"+eventName+\") specified. Should contain 1 to 40 alphanumeric characters or underscores. The name must start with an alphabetic character.\");}var params={en:eventName,_et:Date.now(),'ep.origin':options.origin};if(eventParams){for(var key in eventParams){if(key==='items'&&Array.isArray(eventParams[key])){eventParams[key].forEach(function(item,index){var itemFields=[];var customItemFieldCount=0;Object.keys(item).forEach(function(itemKey){if(SHORT_EVENT_ITEM_PARAMS[itemKey]){itemFields.push(\"\"+SHORT_EVENT_ITEM_PARAMS[itemKey]+item[itemKey]);}else{itemFields.push(\"k\"+customItemFieldCount+itemKey);itemFields.push(\"v\"+customItemFieldCount+item[itemKey]);customItemFieldCount++;}});params[\"pr\"+(index+1)]=itemFields.join('~');});}else{var paramKey=SHORT_EVENT_PARAMS[key]||(typeof eventParams[key]==='number'?\"epn.\"+key:\"ep.\"+key);params[paramKey]=eventParams[key];}}}return params;}},{key:\"parseUserProperty\",value:function parseUserProperty(options,userPropertyName,userPropertyValue){if(!FirebaseAnalyticsJS.isValidName(userPropertyName,24)||userPropertyName==='user_id'){throw new Error(\"Invalid user-property name (\"+userPropertyName+\") specified. Should contain 1 to 24 alphanumeric characters or underscores. The name must start with an alphabetic character.\");}if(userPropertyValue!==undefined&&userPropertyValue!==null&&options.strictNativeEmulation&&(typeof userPropertyValue!=='string'||userPropertyValue.length>36)){throw new Error('Invalid user-property value specified. Value should be a string of up to 36 characters long.');}return typeof userPropertyValue==='number'?\"upn.\"+userPropertyName:\"up.\"+userPropertyName;}}]);return FirebaseAnalyticsJS;}();function encodeQueryArgs(queryArgs,lastTime){var keys=Object.keys(queryArgs);if(lastTime<0){keys=keys.filter(function(key){return key!=='_et';});}return keys.map(function(key){return key+\"=\"+encodeURIComponent(key==='_et'?Math.max(queryArgs[key]-lastTime,0):queryArgs[key]);}).join('&');}var SHORT_EVENT_PARAMS={currency:'cu'};var SHORT_EVENT_ITEM_PARAMS={id:'id',name:'nm',brand:'br',category:'ca',coupon:'cp',list:'ln',list_name:'ln',list_position:'lp',price:'pr',location_id:'lo',quantity:'qt',variant:'va',affiliation:'af',discount:'ds'};export default FirebaseAnalyticsJS;","map":{"version":3,"sources":["../src/FirebaseAnalyticsJS.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  FirebaseAnalyticsJSCodedEvent,\n  FirebaseAnalyticsJSConfig,\n  FirebaseAnalyticsJSOptions,\n} from './FirebaseAnalyticsJS.types';\n\n/**\n * A pure JavaScript Google Firebase Analytics implementation that uses\n * the HTTPS Measurement API 2 to send events to Google Analytics.\n *\n * This class provides an alternative for the Firebase Analytics module\n * shipped with the Firebase JS SDK. That library uses the gtag.js dependency\n * and requires certain browser features. This prevents the use\n * analytics on other platforms, such as Node-js and react-native.\n *\n * FirebaseAnalyticsJS provides a bare-bone implementation of the new\n * HTTPS Measurement API 2 protocol (which is undocumented), with an API\n * that follows the Firebase Analytics JS SDK.\n */\nclass FirebaseAnalyticsJS {\n  public readonly url: string;\n  private enabled: boolean;\n  public readonly config: FirebaseAnalyticsJSConfig;\n  private userId?: string;\n  private userProperties?: { [key: string]: any };\n  private eventQueue = new Set<FirebaseAnalyticsJSCodedEvent>();\n  private options: FirebaseAnalyticsJSOptions;\n  private flushEventsPromise: Promise<void> = Promise.resolve();\n  private flushEventsTimer: any;\n  private lastTime: number = -1;\n  private sequenceNr: number = 1;\n\n  constructor(config: FirebaseAnalyticsJSConfig, options: FirebaseAnalyticsJSOptions) {\n    // Verify the measurement- & client Ids\n    if (!config.measurementId)\n      throw new Error(\n        'No valid measurementId. Make sure to provide a valid measurementId with a G-XXXXXXXXXX format.'\n      );\n    if (!options.clientId)\n      throw new Error(\n        'No valid clientId. Make sure to provide a valid clientId with a UUID (v4) format.'\n      );\n\n    // Initialize\n    this.url = 'https://www.google-analytics.com/g/collect';\n    this.enabled = true;\n    this.config = config;\n    this.options = {\n      customArgs: {},\n      maxCacheTime: 5000,\n      strictNativeEmulation: false,\n      origin: 'firebase',\n      ...options,\n    };\n  }\n\n  /**\n   * Sends 1 or more coded-events to the back-end.\n   * When only 1 event is provided, it is send inside the query URL.\n   * When more than 1 event is provided, the event-data is send in\n   * the body of the POST request.\n   */\n  private async send(events: Set<FirebaseAnalyticsJSCodedEvent>): Promise<void> {\n    const { config, options } = this;\n    let queryArgs: any = {\n      ...options.customArgs,\n      v: 2,\n      tid: config.measurementId,\n      cid: options.clientId,\n      sid: options.sessionId,\n      _s: this.sequenceNr++,\n      seg: 1,\n    };\n    if (options.sessionNumber) queryArgs.sct = options.sessionNumber;\n    if (options.userLanguage) queryArgs.ul = options.userLanguage;\n    if (options.appName) queryArgs.an = options.appName;\n    if (options.appVersion) queryArgs.av = options.appVersion;\n    if (options.docTitle) queryArgs.dt = options.docTitle;\n    if (options.docLocation) queryArgs.dl = options.docLocation;\n    if (options.screenRes) queryArgs.sr = options.screenRes;\n    if (options.debug) queryArgs._dbg = 1;\n    if (this.sequenceNr === 2) queryArgs._ss = 1; // Session start\n    let body;\n\n    const lastTime = this.lastTime;\n    if (events.size > 1) {\n      body = '';\n      events.forEach((event) => {\n        body += encodeQueryArgs(event, this.lastTime) + '\\n';\n        this.lastTime = event._et;\n      });\n    } else if (events.size === 1) {\n      const event = events.values().next().value;\n      this.lastTime = event._et;\n      queryArgs = {\n        ...event,\n        ...queryArgs,\n      };\n    }\n    const args = encodeQueryArgs(queryArgs, lastTime);\n    const url = `${this.url}?${args}`;\n    await fetch(url, {\n      method: 'POST',\n      mode: 'no-cors',\n      cache: 'no-cache',\n      headers: {\n        'Content-Type': 'text/plain;charset=UTF-8',\n        ...(options.headers || {}),\n      },\n      body,\n    });\n  }\n\n  private async addEvent(event: FirebaseAnalyticsJSCodedEvent) {\n    const { userId, userProperties, options } = this;\n\n    // Extend the event with the currently set User-id\n    if (userId) event.uid = userId;\n\n    // Add user-properties\n    if (userProperties) {\n      for (const name in userProperties) {\n        event[name] = userProperties[name];\n      }\n\n      // Reset user-properties after the first event. This is what gtag.js seems\n      // to do as well, although I couldn't find any docs explaining this behavior.\n      this.userProperties = undefined;\n    }\n\n    // Add the event to the queue\n    this.eventQueue.add(event);\n\n    // Start debounce timer\n    if (!this.flushEventsTimer) {\n      this.flushEventsTimer = setTimeout(\n        async () => {\n          this.flushEventsTimer = undefined;\n          try {\n            await this.flushEventsPromise;\n          } catch (err) {\n            // nop\n          }\n          this.flushEventsPromise = this.flushEvents();\n        },\n        options.debug ? 10 : options.maxCacheTime\n      );\n    }\n  }\n\n  private async flushEvents() {\n    if (!this.eventQueue.size) return;\n    const events = new Set<FirebaseAnalyticsJSCodedEvent>(this.eventQueue);\n    await this.send(events);\n    events.forEach((event) => this.eventQueue.delete(event));\n  }\n\n  /**\n   * Clears any queued events and cancels the flush timer.\n   */\n  clearEvents() {\n    this.eventQueue.clear();\n    if (this.flushEventsTimer) {\n      clearTimeout(this.flushEventsTimer);\n      this.flushEventsTimer = 0;\n    }\n  }\n\n  private static isValidName(name: string, maxLength: number): boolean {\n    return !!(\n      name &&\n      name.length &&\n      name.length <= maxLength &&\n      name.match(/^[A-Za-z][A-Za-z_\\d]*$/) &&\n      !name.startsWith('firebase_') &&\n      !name.startsWith('google_') &&\n      !name.startsWith('ga_')\n    );\n  }\n\n  /**\n   * Parses an event (as passed to logEvent) and throws an error when the\n   * event-name or parameters are invalid.\n   *\n   * Upon success, returns the event in encoded format, ready to be send\n   * through the Google Measurement API v2.\n   */\n  static parseEvent(\n    options: FirebaseAnalyticsJSOptions,\n    eventName: string,\n    eventParams?: { [key: string]: any }\n  ): FirebaseAnalyticsJSCodedEvent {\n    if (!FirebaseAnalyticsJS.isValidName(eventName, 40)) {\n      throw new Error(\n        `Invalid event-name (${eventName}) specified. Should contain 1 to 40 alphanumeric characters or underscores. The name must start with an alphabetic character.`\n      );\n    }\n    const params: FirebaseAnalyticsJSCodedEvent = {\n      en: eventName,\n      _et: Date.now(),\n      'ep.origin': options.origin,\n    };\n    if (eventParams) {\n      for (const key in eventParams) {\n        if (key === 'items' && Array.isArray(eventParams[key])) {\n          eventParams[key].forEach((item, index) => {\n            const itemFields: string[] = [];\n            let customItemFieldCount = 0;\n            Object.keys(item).forEach((itemKey) => {\n              if (SHORT_EVENT_ITEM_PARAMS[itemKey]) {\n                itemFields.push(`${SHORT_EVENT_ITEM_PARAMS[itemKey]}${item[itemKey]}`);\n              } else {\n                itemFields.push(`k${customItemFieldCount}${itemKey}`);\n                itemFields.push(`v${customItemFieldCount}${item[itemKey]}`);\n                customItemFieldCount++;\n              }\n            });\n            params[`pr${index + 1}`] = itemFields.join('~');\n          });\n        } else {\n          const paramKey =\n            SHORT_EVENT_PARAMS[key] ||\n            (typeof eventParams[key] === 'number' ? `epn.${key}` : `ep.${key}`);\n          params[paramKey] = eventParams[key];\n        }\n      }\n    }\n    return params;\n  }\n\n  /**\n   * Parses user-properties (as passed to setUserProperties) and throws an error when\n   * one of the user properties is invalid.\n   *\n   * Upon success, returns the user-properties in encoded format, ready to be send\n   * through the Google Measurement API v2.\n   */\n  static parseUserProperty(\n    options: FirebaseAnalyticsJSOptions,\n    userPropertyName: string,\n    userPropertyValue: any\n  ): string {\n    if (!FirebaseAnalyticsJS.isValidName(userPropertyName, 24) || userPropertyName === 'user_id') {\n      throw new Error(\n        `Invalid user-property name (${userPropertyName}) specified. Should contain 1 to 24 alphanumeric characters or underscores. The name must start with an alphabetic character.`\n      );\n    }\n    if (\n      userPropertyValue !== undefined &&\n      userPropertyValue !== null &&\n      options.strictNativeEmulation &&\n      (typeof userPropertyValue !== 'string' || userPropertyValue.length > 36)\n    ) {\n      throw new Error(\n        'Invalid user-property value specified. Value should be a string of up to 36 characters long.'\n      );\n    }\n    return typeof userPropertyValue === 'number'\n      ? `upn.${userPropertyName}`\n      : `up.${userPropertyName}`;\n  }\n\n  /**\n   * https://firebase.google.com/docs/reference/js/firebase.analytics.Analytics#log-event\n   */\n  async logEvent(eventName: string, eventParams?: { [key: string]: any }): Promise<void> {\n    const event = FirebaseAnalyticsJS.parseEvent(this.options, eventName, eventParams);\n    if (!this.enabled) return;\n    if (this.options.debug) {\n      console.log(\n        `FirebaseAnalytics event: \"${eventName}\", params: ${JSON.stringify(\n          eventParams,\n          undefined,\n          2\n        )}`\n      );\n    }\n    return this.addEvent(event);\n  }\n\n  /**\n   * https://firebase.google.com/docs/reference/js/firebase.analytics.Analytics#set-analytics-collection-enabled\n   */\n  async setAnalyticsCollectionEnabled(isEnabled: boolean): Promise<void> {\n    this.enabled = isEnabled;\n  }\n\n  /**\n   * Not supported, this method is a no-op\n   */\n  async setSessionTimeoutDuration(_sessionTimeoutInterval: number): Promise<void> {\n    // no-op\n  }\n\n  /**\n   * https://firebase.google.com/docs/reference/js/firebase.analytics.Analytics#set-user-id\n   */\n  async setUserId(userId: string | null): Promise<void> {\n    if (!this.enabled) return;\n    this.userId = userId || undefined;\n  }\n\n  /**\n   * https://firebase.google.com/docs/reference/js/firebase.analytics.Analytics#set-user-properties\n   */\n  async setUserProperties(userProperties: { [key: string]: any }): Promise<void> {\n    if (!this.enabled) return;\n    for (const name in userProperties) {\n      const val = userProperties[name];\n      const key = FirebaseAnalyticsJS.parseUserProperty(this.options, name, val);\n      if (val === null || val === undefined) {\n        if (this.userProperties) {\n          delete this.userProperties[key];\n        }\n      } else {\n        this.userProperties = this.userProperties || {};\n        this.userProperties[key] = val;\n      }\n    }\n  }\n\n  /**\n   * Clears all analytics data for this instance.\n   */\n  async resetAnalyticsData() {\n    this.clearEvents();\n    this.userId = undefined;\n    this.userProperties = undefined;\n  }\n\n  /**\n   * Enables or disabled debug mode.\n   */\n  async setDebugModeEnabled(isEnabled: boolean): Promise<void> {\n    this.options.debug = isEnabled;\n  }\n\n  /**\n   * Sets a new value for the client ID.\n   */\n  setClientId(clientId: string) {\n    this.options.clientId = clientId;\n  }\n}\n\nfunction encodeQueryArgs(queryArgs: FirebaseAnalyticsJSCodedEvent, lastTime: number): string {\n  let keys = Object.keys(queryArgs);\n  if (lastTime < 0) {\n    keys = keys.filter((key) => key !== '_et');\n  }\n  return keys\n    .map((key) => {\n      return `${key}=${encodeURIComponent(\n        key === '_et' ? Math.max(queryArgs[key] - lastTime, 0) : queryArgs[key]\n      )}`;\n    })\n    .join('&');\n}\n\nconst SHORT_EVENT_PARAMS = {\n  currency: 'cu',\n};\n\n// https://developers.google.com/gtagjs/reference/event\nconst SHORT_EVENT_ITEM_PARAMS = {\n  id: 'id',\n  name: 'nm',\n  brand: 'br',\n  category: 'ca',\n  coupon: 'cp',\n  list: 'ln', // deprecated, use `list_name` instead\n  list_name: 'ln',\n  list_position: 'lp',\n  price: 'pr',\n  location_id: 'lo',\n  quantity: 'qt',\n  variant: 'va',\n  affiliation: 'af',\n  discount: 'ds',\n};\n\nexport default FirebaseAnalyticsJS;\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}