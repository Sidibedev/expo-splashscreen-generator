{"ast":null,"code":"import _toConsumableArray from\"@babel/runtime/helpers/toConsumableArray\";import _extends from\"@babel/runtime/helpers/extends\";function _createForOfIteratorHelperLoose(o,allowArrayLike){var it=typeof Symbol!==\"undefined\"&&o[Symbol.iterator]||o[\"@@iterator\"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length===\"number\"){if(it)o=it;var i=0;return function(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};};}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o===\"string\")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n===\"Object\"&&o.constructor)n=o.constructor.name;if(n===\"Map\"||n===\"Set\")return Array.from(o);if(n===\"Arguments\"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}import{useEffect,useRef}from'react';import{startMapper,stopMapper,makeRemote,requestFrame,getTimestamp,makeMutable}from\"../core\";import updateProps,{updatePropsJestWrapper}from\"../UpdateProps\";import{initialUpdaterRun}from\"../animation\";import NativeReanimatedModule from\"../NativeReanimated\";import{useSharedValue}from\"./useSharedValue\";import{buildWorkletsHash,canApplyOptimalisation,getStyleWithoutAnimations,hasColorProps,isAnimated,parseColors,styleDiff,validateAnimatedStyles}from\"./utils\";import{makeViewDescriptorsSet,makeViewsRefSet}from\"../ViewDescriptorsSet\";import{isJest,shouldBeUseWeb}from\"../PlatformChecker\";var prepareAnimation=function(){var _f=function _f(animatedProp,lastAnimation,lastValue){if(Array.isArray(animatedProp)){animatedProp.forEach(function(prop,index){return prepareAnimation(prop,lastAnimation&&lastAnimation[index],lastValue&&lastValue[index]);});}if(typeof animatedProp==='object'&&animatedProp.onFrame){var animation=animatedProp;var value=animation.current;if(lastValue!==undefined){if(typeof lastValue==='object'){if(lastValue.value!==undefined){value=lastValue.value;}else if(lastValue.onFrame!==undefined){if((lastAnimation===null||lastAnimation===void 0?void 0:lastAnimation.current)!==undefined){value=lastAnimation.current;}else if((lastValue===null||lastValue===void 0?void 0:lastValue.current)!==undefined){value=lastValue.current;}}}else{value=lastValue;}}animation.callStart=function(timestamp){animation.onStart(animation,value,timestamp,lastAnimation);};animation.callStart(getTimestamp());animation.callStart=null;}else if(typeof animatedProp==='object'){Object.keys(animatedProp).forEach(function(key){return prepareAnimation(animatedProp[key],lastAnimation&&lastAnimation[key],lastValue&&lastValue[key]);});}};_f._closure={getTimestamp:getTimestamp};_f.asString=\"function prepareAnimation(animatedProp,lastAnimation,lastValue){const{getTimestamp}=jsThis._closure;{if(Array.isArray(animatedProp)){animatedProp.forEach(function(prop,index){return prepareAnimation(prop,lastAnimation&&lastAnimation[index],lastValue&&lastValue[index]);});}if(typeof animatedProp==='object'&&animatedProp.onFrame){const animation=animatedProp;let value=animation.current;if(lastValue!==undefined){if(typeof lastValue==='object'){if(lastValue.value!==undefined){value=lastValue.value;}else if(lastValue.onFrame!==undefined){if((lastAnimation===null||lastAnimation===void 0?void 0:lastAnimation.current)!==undefined){value=lastAnimation.current;}else if((lastValue===null||lastValue===void 0?void 0:lastValue.current)!==undefined){value=lastValue.current;}}}else{value=lastValue;}}animation.callStart=function(timestamp){animation.onStart(animation,value,timestamp,lastAnimation);};animation.callStart(getTimestamp());animation.callStart=null;}else if(typeof animatedProp==='object'){Object.keys(animatedProp).forEach(function(key){return prepareAnimation(animatedProp[key],lastAnimation&&lastAnimation[key],lastValue&&lastValue[key]);});}}}\";_f.__workletHash=1333702046144;_f.__location=\"/Users/mas/Documents/perso/expo-splashscreen-generator/node_modules/react-native-reanimated/lib/reanimated2/hook/useAnimatedStyle.js (11:0)\";global.__reanimatedWorkletInit(_f);return _f;}();var runAnimations=function(){var _f=function _f(animation,timestamp,key,result,animationsActive){if(!animationsActive.value){return true;}if(Array.isArray(animation)){result[key]=[];var allFinished=true;animation.forEach(function(entry,index){if(!runAnimations(entry,timestamp,index,result[key],animationsActive)){allFinished=false;}});return allFinished;}else if(typeof animation==='object'&&animation.onFrame){var finished=true;if(!animation.finished){if(animation.callStart){animation.callStart(timestamp);animation.callStart=null;}finished=animation.onFrame(animation,timestamp);animation.timestamp=timestamp;if(finished){animation.finished=true;animation.callback&&animation.callback(true);}}result[key]=animation.current;return finished;}else if(typeof animation==='object'){result[key]={};var _allFinished=true;Object.keys(animation).forEach(function(k){if(!runAnimations(animation[k],timestamp,k,result[key],animationsActive)){_allFinished=false;}});return _allFinished;}else{result[key]=animation;return true;}};_f._closure={};_f.asString=\"function runAnimations(animation,timestamp,key,result,animationsActive){if(!animationsActive.value){return true;}if(Array.isArray(animation)){result[key]=[];let allFinished=true;animation.forEach(function(entry,index){if(!runAnimations(entry,timestamp,index,result[key],animationsActive)){allFinished=false;}});return allFinished;}else if(typeof animation==='object'&&animation.onFrame){let finished=true;if(!animation.finished){if(animation.callStart){animation.callStart(timestamp);animation.callStart=null;}finished=animation.onFrame(animation,timestamp);animation.timestamp=timestamp;if(finished){animation.finished=true;animation.callback&&animation.callback(true);}}result[key]=animation.current;return finished;}else if(typeof animation==='object'){result[key]={};let allFinished=true;Object.keys(animation).forEach(function(k){if(!runAnimations(animation[k],timestamp,k,result[key],animationsActive)){allFinished=false;}});return allFinished;}else{result[key]=animation;return true;}}\";_f.__workletHash=3625332641327;_f.__location=\"/Users/mas/Documents/perso/expo-splashscreen-generator/node_modules/react-native-reanimated/lib/reanimated2/hook/useAnimatedStyle.js (53:0)\";global.__reanimatedWorkletInit(_f);return _f;}();var styleUpdater=function(){var _f=function _f(viewDescriptors,updater,state,maybeViewRef,animationsActive){var _a,_b;var animations=(_a=state.animations)!==null&&_a!==void 0?_a:{};var newValues=(_b=updater())!==null&&_b!==void 0?_b:{};var oldValues=state.last;var hasAnimations=false;for(var key in newValues){var value=newValues[key];if(isAnimated(value)){prepareAnimation(value,animations[key],oldValues[key]);animations[key]=value;hasAnimations=true;}else{delete animations[key];}}if(hasAnimations){var frame=function frame(timestamp){var animations=state.animations,last=state.last,isAnimationCancelled=state.isAnimationCancelled;if(isAnimationCancelled){state.isAnimationRunning=false;return;}var updates={};var allFinished=true;for(var propName in animations){var finished=runAnimations(animations[propName],timestamp,propName,updates,animationsActive);if(finished){last[propName]=updates[propName];delete animations[propName];}else{allFinished=false;}}if(updates){updateProps(viewDescriptors,updates,maybeViewRef);}if(!allFinished){requestFrame(frame);}else{state.isAnimationRunning=false;}};state.animations=animations;if(!state.isAnimationRunning){state.isAnimationCancelled=false;state.isAnimationRunning=true;if(_frameTimestamp){frame(_frameTimestamp);}else{requestFrame(frame);}}state.last=_extends({},oldValues,newValues);var style=getStyleWithoutAnimations(state.last);if(style){updateProps(viewDescriptors,style,maybeViewRef);}}else{state.isAnimationCancelled=true;state.animations=[];updateProps(viewDescriptors,newValues,maybeViewRef);}};_f._closure={isAnimated:isAnimated,prepareAnimation:prepareAnimation,runAnimations:runAnimations,updateProps:updateProps,requestFrame:requestFrame,getStyleWithoutAnimations:getStyleWithoutAnimations};_f.asString=\"function styleUpdater(viewDescriptors,updater,state,maybeViewRef,animationsActive){const{isAnimated,prepareAnimation,runAnimations,updateProps,requestFrame,getStyleWithoutAnimations}=jsThis._closure;{var _a,_b;const animations=(_a=state.animations)!==null&&_a!==void 0?_a:{};const newValues=(_b=updater())!==null&&_b!==void 0?_b:{};const oldValues=state.last;let hasAnimations=false;for(const key in newValues){const value=newValues[key];if(isAnimated(value)){prepareAnimation(value,animations[key],oldValues[key]);animations[key]=value;hasAnimations=true;}else{delete animations[key];}}if(hasAnimations){const frame=function(timestamp){const{animations:animations,last:last,isAnimationCancelled:isAnimationCancelled}=state;if(isAnimationCancelled){state.isAnimationRunning=false;return;}const updates={};let allFinished=true;for(const propName in animations){const finished=runAnimations(animations[propName],timestamp,propName,updates,animationsActive);if(finished){last[propName]=updates[propName];delete animations[propName];}else{allFinished=false;}}if(updates){updateProps(viewDescriptors,updates,maybeViewRef);}if(!allFinished){requestFrame(frame);}else{state.isAnimationRunning=false;}};state.animations=animations;if(!state.isAnimationRunning){state.isAnimationCancelled=false;state.isAnimationRunning=true;if(_frameTimestamp){frame(_frameTimestamp);}else{requestFrame(frame);}}state.last=Object.assign({},oldValues,newValues);const style=getStyleWithoutAnimations(state.last);if(style){updateProps(viewDescriptors,style,maybeViewRef);}}else{state.isAnimationCancelled=true;state.animations=[];updateProps(viewDescriptors,newValues,maybeViewRef);}}}\";_f.__workletHash=10064957750910;_f.__location=\"/Users/mas/Documents/perso/expo-splashscreen-generator/node_modules/react-native-reanimated/lib/reanimated2/hook/useAnimatedStyle.js (100:0)\";global.__reanimatedWorkletInit(_f);return _f;}();var jestStyleUpdater=function(){var _f=function _f(viewDescriptors,updater,state,maybeViewRef,animationsActive,animatedStyle){var adapters=arguments.length>6&&arguments[6]!==undefined?arguments[6]:[];var _a,_b;var animations=(_a=state.animations)!==null&&_a!==void 0?_a:{};var newValues=(_b=updater())!==null&&_b!==void 0?_b:{};var oldValues=state.last;var hasAnimations=false;Object.keys(animations).forEach(function(key){var value=newValues[key];if(!isAnimated(value)){delete animations[key];}});Object.keys(newValues).forEach(function(key){var value=newValues[key];if(isAnimated(value)){prepareAnimation(value,animations[key],oldValues[key]);animations[key]=value;hasAnimations=true;}});function frame(timestamp){var animations=state.animations,last=state.last,isAnimationCancelled=state.isAnimationCancelled;if(isAnimationCancelled){state.isAnimationRunning=false;return;}var updates={};var allFinished=true;Object.keys(animations).forEach(function(propName){var finished=runAnimations(animations[propName],timestamp,propName,updates,animationsActive);if(finished){last[propName]=updates[propName];delete animations[propName];}else{allFinished=false;}});if(Object.keys(updates).length){updatePropsJestWrapper(viewDescriptors,updates,maybeViewRef,animatedStyle,adapters);}if(!allFinished){requestFrame(frame);}else{state.isAnimationRunning=false;}}if(hasAnimations){state.animations=animations;if(!state.isAnimationRunning){state.isAnimationCancelled=false;state.isAnimationRunning=true;if(_frameTimestamp){frame(_frameTimestamp);}else{requestFrame(frame);}}}else{state.isAnimationCancelled=true;state.animations=[];}var diff=styleDiff(oldValues,newValues);state.last=_extends({},oldValues,newValues);if(Object.keys(diff).length!==0){updatePropsJestWrapper(viewDescriptors,diff,maybeViewRef,animatedStyle,adapters);}};_f._closure={isAnimated:isAnimated,prepareAnimation:prepareAnimation,runAnimations:runAnimations,updatePropsJestWrapper:updatePropsJestWrapper,requestFrame:requestFrame,styleDiff:styleDiff};_f.asString=\"function jestStyleUpdater(viewDescriptors,updater,state,maybeViewRef,animationsActive,animatedStyle,adapters=[]){const{isAnimated,prepareAnimation,runAnimations,updatePropsJestWrapper,requestFrame,styleDiff}=jsThis._closure;{var _a,_b;const animations=(_a=state.animations)!==null&&_a!==void 0?_a:{};const newValues=(_b=updater())!==null&&_b!==void 0?_b:{};const oldValues=state.last;let hasAnimations=false;Object.keys(animations).forEach(function(key){const value=newValues[key];if(!isAnimated(value)){delete animations[key];}});Object.keys(newValues).forEach(function(key){const value=newValues[key];if(isAnimated(value)){prepareAnimation(value,animations[key],oldValues[key]);animations[key]=value;hasAnimations=true;}});function frame(timestamp){const{animations:animations,last:last,isAnimationCancelled:isAnimationCancelled}=state;if(isAnimationCancelled){state.isAnimationRunning=false;return;}const updates={};let allFinished=true;Object.keys(animations).forEach(function(propName){const finished=runAnimations(animations[propName],timestamp,propName,updates,animationsActive);if(finished){last[propName]=updates[propName];delete animations[propName];}else{allFinished=false;}});if(Object.keys(updates).length){updatePropsJestWrapper(viewDescriptors,updates,maybeViewRef,animatedStyle,adapters);}if(!allFinished){requestFrame(frame);}else{state.isAnimationRunning=false;}}if(hasAnimations){state.animations=animations;if(!state.isAnimationRunning){state.isAnimationCancelled=false;state.isAnimationRunning=true;if(_frameTimestamp){frame(_frameTimestamp);}else{requestFrame(frame);}}}else{state.isAnimationCancelled=true;state.animations=[];}const diff=styleDiff(oldValues,newValues);state.last=Object.assign({},oldValues,newValues);if(Object.keys(diff).length!==0){updatePropsJestWrapper(viewDescriptors,diff,maybeViewRef,animatedStyle,adapters);}}}\";_f.__workletHash=13781832065631;_f.__location=\"/Users/mas/Documents/perso/expo-splashscreen-generator/node_modules/react-native-reanimated/lib/reanimated2/hook/useAnimatedStyle.js (170:0)\";global.__reanimatedWorkletInit(_f);return _f;}();function checkSharedValueUsage(prop,currentKey){if(Array.isArray(prop)){for(var _iterator=_createForOfIteratorHelperLoose(prop),_step;!(_step=_iterator()).done;){var element=_step.value;checkSharedValueUsage(element,currentKey);}}else if(typeof prop==='object'&&prop.value===undefined){for(var _i=0,_Object$keys=Object.keys(prop);_i<_Object$keys.length;_i++){var key=_Object$keys[_i];checkSharedValueUsage(prop[key],key);}}else if(currentKey!==undefined&&typeof prop==='object'&&prop.value!==undefined){throw new Error(\"invalid value passed to `\"+currentKey+\"`, maybe you forgot to use `.value`?\");}}export function useAnimatedStyle(updater,dependencies,adapters){var _a,_b;var viewsRef=makeViewsRefSet();var viewDescriptors=makeViewDescriptorsSet();var initRef=useRef();var inputs=Object.values((_a=updater._closure)!==null&&_a!==void 0?_a:{});var adaptersArray=adapters?Array.isArray(adapters)?adapters:[adapters]:[];var adaptersHash=adapters?buildWorkletsHash(adaptersArray):null;var animationsActive=useSharedValue(true);var animatedStyle=useRef({});if(!dependencies){dependencies=[].concat(_toConsumableArray(inputs),[updater.__workletHash]);}else{dependencies.push(updater.__workletHash);}adaptersHash&&dependencies.push(adaptersHash);if(!initRef.current){var initialStyle=initialUpdaterRun(updater);validateAnimatedStyles(initialStyle);initRef.current={initial:{value:initialStyle,updater:updater},remoteState:makeRemote({last:initialStyle}),sharableViewDescriptors:makeMutable([])};viewDescriptors.rebuildsharableViewDescriptors(initRef.current.sharableViewDescriptors);}dependencies.push((_b=initRef.current)===null||_b===void 0?void 0:_b.sharableViewDescriptors.value);var _initRef$current=initRef.current,initial=_initRef$current.initial,remoteState=_initRef$current.remoteState,sharableViewDescriptors=_initRef$current.sharableViewDescriptors;var maybeViewRef=NativeReanimatedModule.native?undefined:viewsRef;useEffect(function(){var fun;var upadterFn=updater;var optimalization=updater.__optimalization;if(adapters){upadterFn=function(){var _f=function _f(){var newValues=updater();adaptersArray.forEach(function(adapter){adapter(newValues);});return newValues;};_f._closure={updater:updater,adaptersArray:adaptersArray};_f.asString=\"function _f(){const{updater,adaptersArray}=jsThis._closure;{const newValues=updater();adaptersArray.forEach(function(adapter){adapter(newValues);});return newValues;}}\";_f.__workletHash=15812374835043;_f.__location=\"/Users/mas/Documents/perso/expo-splashscreen-generator/node_modules/react-native-reanimated/lib/reanimated2/hook/useAnimatedStyle.js (311:24)\";global.__reanimatedWorkletInit(_f);return _f;}();}if(canApplyOptimalisation(upadterFn)&&!shouldBeUseWeb()){if(hasColorProps(upadterFn())){upadterFn=function(){var _f=function _f(){var style=upadterFn();parseColors(style);return style;};_f._closure={upadterFn:upadterFn,parseColors:parseColors};_f.asString=\"function _f(){const{upadterFn,parseColors}=jsThis._closure;{const style=upadterFn();parseColors(style);return style;}}\";_f.__workletHash=1270259438741;_f.__location=\"/Users/mas/Documents/perso/expo-splashscreen-generator/node_modules/react-native-reanimated/lib/reanimated2/hook/useAnimatedStyle.js (322:28)\";global.__reanimatedWorkletInit(_f);return _f;}();}}else if(!shouldBeUseWeb()){optimalization=0;upadterFn=function(){var _f=function _f(){var style=upadterFn();parseColors(style);return style;};_f._closure={upadterFn:upadterFn,parseColors:parseColors};_f.asString=\"function _f(){const{upadterFn,parseColors}=jsThis._closure;{const style=upadterFn();parseColors(style);return style;}}\";_f.__workletHash=1270259438741;_f.__location=\"/Users/mas/Documents/perso/expo-splashscreen-generator/node_modules/react-native-reanimated/lib/reanimated2/hook/useAnimatedStyle.js (332:24)\";global.__reanimatedWorkletInit(_f);return _f;}();}if(typeof updater.__optimalization!==undefined){upadterFn.__optimalization=optimalization;}if(isJest()){fun=function(){var _f=function _f(){jestStyleUpdater(sharableViewDescriptors,updater,remoteState,maybeViewRef,animationsActive,animatedStyle,adaptersArray);};_f._closure={jestStyleUpdater:jestStyleUpdater,sharableViewDescriptors:sharableViewDescriptors,updater:updater,remoteState:remoteState,maybeViewRef:maybeViewRef,animationsActive:animationsActive,animatedStyle:animatedStyle,adaptersArray:adaptersArray};_f.asString=\"function _f(){const{jestStyleUpdater,sharableViewDescriptors,updater,remoteState,maybeViewRef,animationsActive,animatedStyle,adaptersArray}=jsThis._closure;{jestStyleUpdater(sharableViewDescriptors,updater,remoteState,maybeViewRef,animationsActive,animatedStyle,adaptersArray);}}\";_f.__workletHash=11302607948209;_f.__location=\"/Users/mas/Documents/perso/expo-splashscreen-generator/node_modules/react-native-reanimated/lib/reanimated2/hook/useAnimatedStyle.js (343:18)\";global.__reanimatedWorkletInit(_f);return _f;}();}else{fun=function(){var _f=function _f(){styleUpdater(sharableViewDescriptors,upadterFn,remoteState,maybeViewRef,animationsActive);};_f._closure={styleUpdater:styleUpdater,sharableViewDescriptors:sharableViewDescriptors,upadterFn:upadterFn,remoteState:remoteState,maybeViewRef:maybeViewRef,animationsActive:animationsActive};_f.asString=\"function _f(){const{styleUpdater,sharableViewDescriptors,upadterFn,remoteState,maybeViewRef,animationsActive}=jsThis._closure;{styleUpdater(sharableViewDescriptors,upadterFn,remoteState,maybeViewRef,animationsActive);}}\";_f.__workletHash=13265500227473;_f.__location=\"/Users/mas/Documents/perso/expo-splashscreen-generator/node_modules/react-native-reanimated/lib/reanimated2/hook/useAnimatedStyle.js (349:18)\";global.__reanimatedWorkletInit(_f);return _f;}();}var mapperId=startMapper(fun,inputs,[],upadterFn,sharableViewDescriptors);return function(){stopMapper(mapperId);};},dependencies);useEffect(function(){animationsActive.value=true;return function(){animationsActive.value=false;};},[]);checkSharedValueUsage(initial.value);if(process.env.JEST_WORKER_ID){return{viewDescriptors:viewDescriptors,initial:initial,viewsRef:viewsRef,animatedStyle:animatedStyle};}else{return{viewDescriptors:viewDescriptors,initial:initial,viewsRef:viewsRef};}}","map":{"version":3,"sources":["/Users/mas/Documents/perso/expo-splashscreen-generator/node_modules/react-native-reanimated/lib/reanimated2/hook/useAnimatedStyle.js"],"names":["useEffect","useRef","startMapper","stopMapper","makeRemote","requestFrame","getTimestamp","makeMutable","updateProps","updatePropsJestWrapper","initialUpdaterRun","NativeReanimatedModule","useSharedValue","buildWorkletsHash","canApplyOptimalisation","getStyleWithoutAnimations","hasColorProps","isAnimated","parseColors","styleDiff","validateAnimatedStyles","makeViewDescriptorsSet","makeViewsRefSet","isJest","shouldBeUseWeb","prepareAnimation","animatedProp","lastAnimation","lastValue","Array","isArray","forEach","prop","index","onFrame","animation","value","current","undefined","callStart","timestamp","onStart","Object","keys","key","runAnimations","result","animationsActive","allFinished","entry","finished","callback","k","styleUpdater","viewDescriptors","updater","state","maybeViewRef","_a","_b","animations","newValues","oldValues","last","hasAnimations","frame","isAnimationCancelled","isAnimationRunning","updates","propName","_frameTimestamp","style","jestStyleUpdater","animatedStyle","adapters","length","diff","checkSharedValueUsage","currentKey","element","Error","useAnimatedStyle","dependencies","viewsRef","initRef","inputs","values","_closure","adaptersArray","adaptersHash","__workletHash","push","initialStyle","initial","remoteState","sharableViewDescriptors","rebuildsharableViewDescriptors","native","fun","upadterFn","optimalization","__optimalization","adapter","mapperId","process","env","JEST_WORKER_ID"],"mappings":"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","sourcesContent":["/* global _frameTimestamp */\nimport { useEffect, useRef } from 'react';\nimport { startMapper, stopMapper, makeRemote, requestFrame, getTimestamp, makeMutable, } from '../core';\nimport updateProps, { updatePropsJestWrapper } from '../UpdateProps';\nimport { initialUpdaterRun } from '../animation';\nimport NativeReanimatedModule from '../NativeReanimated';\nimport { useSharedValue } from './useSharedValue';\nimport { buildWorkletsHash, canApplyOptimalisation, getStyleWithoutAnimations, hasColorProps, isAnimated, parseColors, styleDiff, validateAnimatedStyles, } from './utils';\nimport { makeViewDescriptorsSet, makeViewsRefSet, } from '../ViewDescriptorsSet';\nimport { isJest, shouldBeUseWeb } from '../PlatformChecker';\nfunction prepareAnimation(animatedProp, lastAnimation, lastValue) {\n    'worklet';\n    if (Array.isArray(animatedProp)) {\n        animatedProp.forEach((prop, index) => prepareAnimation(prop, lastAnimation && lastAnimation[index], lastValue && lastValue[index]));\n        // return animatedProp;\n    }\n    if (typeof animatedProp === 'object' && animatedProp.onFrame) {\n        const animation = animatedProp;\n        let value = animation.current;\n        if (lastValue !== undefined) {\n            if (typeof lastValue === 'object') {\n                if (lastValue.value !== undefined) {\n                    // previously it was a shared value\n                    value = lastValue.value;\n                }\n                else if (lastValue.onFrame !== undefined) {\n                    if ((lastAnimation === null || lastAnimation === void 0 ? void 0 : lastAnimation.current) !== undefined) {\n                        // it was an animation before, copy its state\n                        value = lastAnimation.current;\n                    }\n                    else if ((lastValue === null || lastValue === void 0 ? void 0 : lastValue.current) !== undefined) {\n                        // it was initialized\n                        value = lastValue.current;\n                    }\n                }\n            }\n            else {\n                // previously it was a plain value, just set it as starting point\n                value = lastValue;\n            }\n        }\n        animation.callStart = (timestamp) => {\n            animation.onStart(animation, value, timestamp, lastAnimation);\n        };\n        animation.callStart(getTimestamp());\n        animation.callStart = null;\n    }\n    else if (typeof animatedProp === 'object') {\n        // it is an object\n        Object.keys(animatedProp).forEach((key) => prepareAnimation(animatedProp[key], lastAnimation && lastAnimation[key], lastValue && lastValue[key]));\n    }\n}\nfunction runAnimations(animation, timestamp, key, result, animationsActive) {\n    'worklet';\n    if (!animationsActive.value) {\n        return true;\n    }\n    if (Array.isArray(animation)) {\n        result[key] = [];\n        let allFinished = true;\n        animation.forEach((entry, index) => {\n            if (!runAnimations(entry, timestamp, index, result[key], animationsActive)) {\n                allFinished = false;\n            }\n        });\n        return allFinished;\n    }\n    else if (typeof animation === 'object' && animation.onFrame) {\n        let finished = true;\n        if (!animation.finished) {\n            if (animation.callStart) {\n                animation.callStart(timestamp);\n                animation.callStart = null;\n            }\n            finished = animation.onFrame(animation, timestamp);\n            animation.timestamp = timestamp;\n            if (finished) {\n                animation.finished = true;\n                animation.callback && animation.callback(true /* finished */);\n            }\n        }\n        result[key] = animation.current;\n        return finished;\n    }\n    else if (typeof animation === 'object') {\n        result[key] = {};\n        let allFinished = true;\n        Object.keys(animation).forEach((k) => {\n            if (!runAnimations(animation[k], timestamp, k, result[key], animationsActive)) {\n                allFinished = false;\n            }\n        });\n        return allFinished;\n    }\n    else {\n        result[key] = animation;\n        return true;\n    }\n}\nfunction styleUpdater(viewDescriptors, updater, state, maybeViewRef, animationsActive) {\n    'worklet';\n    var _a, _b;\n    const animations = (_a = state.animations) !== null && _a !== void 0 ? _a : {};\n    const newValues = (_b = updater()) !== null && _b !== void 0 ? _b : {};\n    const oldValues = state.last;\n    let hasAnimations = false;\n    for (const key in newValues) {\n        const value = newValues[key];\n        if (isAnimated(value)) {\n            prepareAnimation(value, animations[key], oldValues[key]);\n            animations[key] = value;\n            hasAnimations = true;\n        }\n        else {\n            delete animations[key];\n        }\n    }\n    if (hasAnimations) {\n        const frame = (timestamp) => {\n            const { animations, last, isAnimationCancelled } = state;\n            if (isAnimationCancelled) {\n                state.isAnimationRunning = false;\n                return;\n            }\n            const updates = {};\n            let allFinished = true;\n            for (const propName in animations) {\n                const finished = runAnimations(animations[propName], timestamp, propName, updates, animationsActive);\n                if (finished) {\n                    last[propName] = updates[propName];\n                    delete animations[propName];\n                }\n                else {\n                    allFinished = false;\n                }\n            }\n            if (updates) {\n                updateProps(viewDescriptors, updates, maybeViewRef);\n            }\n            if (!allFinished) {\n                requestFrame(frame);\n            }\n            else {\n                state.isAnimationRunning = false;\n            }\n        };\n        state.animations = animations;\n        if (!state.isAnimationRunning) {\n            state.isAnimationCancelled = false;\n            state.isAnimationRunning = true;\n            if (_frameTimestamp) {\n                frame(_frameTimestamp);\n            }\n            else {\n                requestFrame(frame);\n            }\n        }\n        state.last = Object.assign({}, oldValues, newValues);\n        const style = getStyleWithoutAnimations(state.last);\n        if (style) {\n            updateProps(viewDescriptors, style, maybeViewRef);\n        }\n    }\n    else {\n        state.isAnimationCancelled = true;\n        state.animations = [];\n        updateProps(viewDescriptors, newValues, maybeViewRef);\n    }\n}\nfunction jestStyleUpdater(viewDescriptors, updater, state, maybeViewRef, animationsActive, animatedStyle, adapters = []) {\n    'worklet';\n    var _a, _b;\n    const animations = (_a = state.animations) !== null && _a !== void 0 ? _a : {};\n    const newValues = (_b = updater()) !== null && _b !== void 0 ? _b : {};\n    const oldValues = state.last;\n    // extract animated props\n    let hasAnimations = false;\n    Object.keys(animations).forEach((key) => {\n        const value = newValues[key];\n        if (!isAnimated(value)) {\n            delete animations[key];\n        }\n    });\n    Object.keys(newValues).forEach((key) => {\n        const value = newValues[key];\n        if (isAnimated(value)) {\n            prepareAnimation(value, animations[key], oldValues[key]);\n            animations[key] = value;\n            hasAnimations = true;\n        }\n    });\n    function frame(timestamp) {\n        const { animations, last, isAnimationCancelled } = state;\n        if (isAnimationCancelled) {\n            state.isAnimationRunning = false;\n            return;\n        }\n        const updates = {};\n        let allFinished = true;\n        Object.keys(animations).forEach((propName) => {\n            const finished = runAnimations(animations[propName], timestamp, propName, updates, animationsActive);\n            if (finished) {\n                last[propName] = updates[propName];\n                delete animations[propName];\n            }\n            else {\n                allFinished = false;\n            }\n        });\n        if (Object.keys(updates).length) {\n            updatePropsJestWrapper(viewDescriptors, updates, maybeViewRef, animatedStyle, adapters);\n        }\n        if (!allFinished) {\n            requestFrame(frame);\n        }\n        else {\n            state.isAnimationRunning = false;\n        }\n    }\n    if (hasAnimations) {\n        state.animations = animations;\n        if (!state.isAnimationRunning) {\n            state.isAnimationCancelled = false;\n            state.isAnimationRunning = true;\n            if (_frameTimestamp) {\n                frame(_frameTimestamp);\n            }\n            else {\n                requestFrame(frame);\n            }\n        }\n    }\n    else {\n        state.isAnimationCancelled = true;\n        state.animations = [];\n    }\n    // calculate diff\n    const diff = styleDiff(oldValues, newValues);\n    state.last = Object.assign({}, oldValues, newValues);\n    if (Object.keys(diff).length !== 0) {\n        updatePropsJestWrapper(viewDescriptors, diff, maybeViewRef, animatedStyle, adapters);\n    }\n}\n// check for invalid usage of shared values in returned object\nfunction checkSharedValueUsage(prop, currentKey) {\n    if (Array.isArray(prop)) {\n        // if it's an array (i.ex. transform) validate all its elements\n        for (const element of prop) {\n            checkSharedValueUsage(element, currentKey);\n        }\n    }\n    else if (typeof prop === 'object' && prop.value === undefined) {\n        // if it's a nested object, run validation for all its props\n        for (const key of Object.keys(prop)) {\n            checkSharedValueUsage(prop[key], key);\n        }\n    }\n    else if (currentKey !== undefined &&\n        typeof prop === 'object' &&\n        prop.value !== undefined) {\n        // if shared value is passed insted of its value, throw an error\n        throw new Error(`invalid value passed to \\`${currentKey}\\`, maybe you forgot to use \\`.value\\`?`);\n    }\n}\nexport function useAnimatedStyle(updater, dependencies, adapters) {\n    var _a, _b;\n    const viewsRef = makeViewsRefSet();\n    const viewDescriptors = makeViewDescriptorsSet();\n    const initRef = useRef();\n    const inputs = Object.values((_a = updater._closure) !== null && _a !== void 0 ? _a : {});\n    const adaptersArray = adapters\n        ? Array.isArray(adapters)\n            ? adapters\n            : [adapters]\n        : [];\n    const adaptersHash = adapters ? buildWorkletsHash(adaptersArray) : null;\n    const animationsActive = useSharedValue(true);\n    const animatedStyle = useRef({});\n    // build dependencies\n    if (!dependencies) {\n        dependencies = [...inputs, updater.__workletHash];\n    }\n    else {\n        dependencies.push(updater.__workletHash);\n    }\n    adaptersHash && dependencies.push(adaptersHash);\n    if (!initRef.current) {\n        const initialStyle = initialUpdaterRun(updater);\n        validateAnimatedStyles(initialStyle);\n        initRef.current = {\n            initial: {\n                value: initialStyle,\n                updater: updater,\n            },\n            remoteState: makeRemote({ last: initialStyle }),\n            sharableViewDescriptors: makeMutable([]),\n        };\n        viewDescriptors.rebuildsharableViewDescriptors(\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        initRef.current.sharableViewDescriptors);\n    }\n    dependencies.push((_b = initRef.current) === null || _b === void 0 ? void 0 : _b.sharableViewDescriptors.value);\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const { initial, remoteState, sharableViewDescriptors } = initRef.current;\n    const maybeViewRef = NativeReanimatedModule.native ? undefined : viewsRef;\n    useEffect(() => {\n        let fun;\n        let upadterFn = updater;\n        let optimalization = updater.__optimalization;\n        if (adapters) {\n            upadterFn = () => {\n                'worklet';\n                const newValues = updater();\n                adaptersArray.forEach((adapter) => {\n                    adapter(newValues);\n                });\n                return newValues;\n            };\n        }\n        if (canApplyOptimalisation(upadterFn) && !shouldBeUseWeb()) {\n            if (hasColorProps(upadterFn())) {\n                upadterFn = () => {\n                    'worklet';\n                    const style = upadterFn();\n                    parseColors(style);\n                    return style;\n                };\n            }\n        }\n        else if (!shouldBeUseWeb()) {\n            optimalization = 0;\n            upadterFn = () => {\n                'worklet';\n                const style = upadterFn();\n                parseColors(style);\n                return style;\n            };\n        }\n        if (typeof updater.__optimalization !== undefined) {\n            upadterFn.__optimalization = optimalization;\n        }\n        if (isJest()) {\n            fun = () => {\n                'worklet';\n                jestStyleUpdater(sharableViewDescriptors, updater, remoteState, maybeViewRef, animationsActive, animatedStyle, adaptersArray);\n            };\n        }\n        else {\n            fun = () => {\n                'worklet';\n                styleUpdater(sharableViewDescriptors, upadterFn, remoteState, maybeViewRef, animationsActive);\n            };\n        }\n        const mapperId = startMapper(fun, inputs, [], upadterFn, \n        // TODO fix this\n        sharableViewDescriptors);\n        return () => {\n            stopMapper(mapperId);\n        };\n    }, dependencies);\n    useEffect(() => {\n        animationsActive.value = true;\n        return () => {\n            // initRef.current = null;\n            // viewsRef = null;\n            animationsActive.value = false;\n        };\n    }, []);\n    checkSharedValueUsage(initial.value);\n    if (process.env.JEST_WORKER_ID) {\n        return { viewDescriptors, initial: initial, viewsRef, animatedStyle };\n    }\n    else {\n        return { viewDescriptors, initial: initial, viewsRef };\n    }\n}\n"]},"metadata":{},"sourceType":"module"}